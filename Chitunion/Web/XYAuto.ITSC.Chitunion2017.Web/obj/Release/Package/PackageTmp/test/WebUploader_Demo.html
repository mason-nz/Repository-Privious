<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="赤兔联盟广告在线交易平台">
    <meta name="keywords" content="赤兔联盟">
    <title>赤兔联盟广告在线交易平台</title>
    <link rel="stylesheet" type="text/css" href="/css/resetNew.css" />
    <link rel="stylesheet" type="text/css" href="/css/layoutNew.css" />
    <script type="text/javascript" src="/js/jquery.1.11.3.min.js"></script>
    <script type="text/javascript" src="/js/jquery.browser.js"></script>
    <script type="text/javascript" src="/js/tab.js"></script>
    <!--<script type="text/javascript" src="/js/laydate.js"></script>-->
    <script type="text/javascript" src="/js/ejs.min.js"></script>
    <script type="text/javascript" src="/js/common.js"></script>
    <script type="text/javascript" src="/js/Common_chitu.js"></script>
    <script language="javascript" src="/api/check.ashx?NotCheckModule=true&NotRedirectURL=true"
            type="text/javascript"></script>

    <script src="/js/jquery.jmpopups-0.5.1.pack.js" type="text/javascript"></script>
    <script src="/js/jquery.pagination.js" type="text/javascript"></script>
    <script src="/js/common_authority.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="WebUploader/webuploader.css" />
    <script src="WebUploader/webuploader.min.js" type="text/javascript"></script>

    <script type="text/javascript">
        function getCookie(name) {
            var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
            if (arr = document.cookie.match(reg))
                return unescape(arr[2]);
            else
                return null;
        }
        function escapeStr(str) {
            return escape(str).replace(/\+/g, '%2B').replace(/\"/g, '%22').replace(/\'/g, '%27').replace(/\//g, '%2F');
        }

        $(document).ready(function () {
            // 初始化Web Uploader
            var uploader = WebUploader.create({

                // 选完文件后，是否自动上传。
                auto: true,

                formData: { Action: "BatchImport", CarType: "", LoginCookiesContent: escapeStr(getCookie("ct-uinfo")), IsGenSmallImage: 1 },
                fileVal: 'Filedata',
                fileNumLimit: 1,
                //runtimeOrder:'flash',

                //验证单个文件大小是否超出限制, 超出则不允许加入队列
                fileSingleSizeLimit: 50 * 1024 * 1024,
                // swf文件路径
                swf: 'WebUploader/Uploader.swf',

                // 文件接收服务端。
                server: '/AjaxServers/UploadFile.ashx',

                // 选择文件的按钮。可选。
                // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                pick: {
                    id: "#filePicker",//#UploadifyDoc,fileList
                    multiple: false
                },
                // 只允许选择图片文件。
                accept: {
                    title: 'Images',
                    extensions: 'jpg,jpeg,png,pdf,zip',
                    mimeTypes: 'image/*,application/x-zip-compressed,application/pdf'
                },
                // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
                resize: false
            });

            // 当有文件被添加进队列的时候
            uploader.on('fileQueued', function (file) {
                var upfileList = $('#ulFileList');
                upfileList.find('li.fwa label').remove();
                upfileList.show();
                var labelObj = $('<label>').attr('id', file.id).text('等待上传...').width(50);

                upfileList.find('li.fwa a:first').text(file.name).after(labelObj);
            });

            //uploader.on('filesQueued', function (files) {
            //    if (files.length == 1) {
            //        $('#ulFileList').show();
            //        $('#ulFileList').find('li.fwa a').text(files[0].name).attr('fileID', files[0].id);
            //        $('#ulFileList').find('li.fwa label').text("等待上传...");
            //    }
            //});

            //uploader.on('fileDequeued', function (file) {
            //    console.log('fileDequeued,file.id=' + file.id + ',file.name=' + file.name);
            //});


            //// 当有文件被添加进队列的时候
            //uploader.on('filesQueued', function (files) {
            //    $('#ulFileList').show();
            //    $('#ulFileList').find('li.fwa a').text(file.name).attr('fileID', file.id);
            //    $('#ulFileList').find('li.fwa a label').text("等待上传...");
            //    //    .append('<div id="' + file.id + '" class="item">' +
            //    //    '<h4 class="info">' + file.name + '</h4>' +
            //    //    '<p class="state">等待上传...</p>' +
            //    //'</div>');
            //});

            // 文件上传过程中创建进度条实时显示。
            uploader.on('uploadProgress', function (file, percentage) {
                var labelObj = $('#ulFileList li.fwa label[id="' + file.id + '"]');
                if (labelObj.size() > 0) {
                    labelObj.text("上传中(" + percentage * 100 + '%' + ")");
                }
            });
            //当文件上传成功时触发
            uploader.on('uploadSuccess', function (file, response) {
                var labelObj = $('#ulFileList li.fwa label[id="' + file.id + '"]');
                if (labelObj.size() > 0) {
                    labelObj.text("已上传").hide();
                }
                if (!response) {
                    $('#ulFileList').hide();
                }
                else if (response.Status == 0) {
                    $('#ulFileList').hide();
                    alert("上传文件失败," + response.Msg);
                }
                else if (response.Status == 1) {
                    $('#FileName,#downloadFile').attr('href', response.Msg);
                }
            });
            //当文件上传出错时触发
            uploader.on('uploadError', function (file, code) {
                var labelObj = $('#ulFileList li.fwa label[id="' + file.id + '"]');
                if (labelObj.size() > 0) {
                    labelObj.text("上传出错,Code=" + code);
                }
            });
            //不管成功或者失败，文件上传完成时触发
            uploader.on('uploadComplete', function (file) {
                uploader.removeFile(file, true);
                $('#FileName,#downloadFile').removeAttr('href');
            });

            uploader.on("error", function (code) {
                switch (code) {
                    case "Q_TYPE_DENIED": alert("您选择的文件类型不符合规范"); //return false;
                        break;
                    case "Q_EXCEED_SIZE_LIMIT": alert("您选择的文件总大小超出范围"); //return false;
                        break;
                    case "Q_EXCEED_NUM_LIMIT": alert("您选择的文件，已经达到最大队列限制"); //return false;
                        break;
                    case "F_EXCEED_SIZE": alert("您选择的文件总大小超出范围，最大不能超过5MB"); //return false;
                        break;
                    default:
                        alert("其他错误，" + code);
                }
            });


            $('#btnUpload').on('click', function () {
                uploader.upload();
            });
        });
    </script>
</head>
<body>
    <!--#include file="/base/header.html" -->
    <!--中间内容-->
    <div class="order">
        <!--左侧菜单-->
        <!--#include file="/base/Menu.html" -->

        <div class="order_r">
            <div class="install">
                <h2>WebUploader——Demo</h2>
                <div class="clear"></div>
                <!--<div id="uploader-demo">
                    <div id="fileList" class="uploader-list"></div>
                    <div id="filePicker">选择图片</div>
                </div>-->  
                <ul>
                    <li class="hrb"><span class="red f12">*</span>上传附件：</li>
                    <div id="filePicker">选择图片</div>
                    <div class="clear"></div>
                </ul>
                <div class="clear"></div>
                <div class="ml80"> <span class="grey f12">附件:支持格式JPG/PNG/PDF/ZIP，不超过5M</span></div>
                <!--用来存放上传后文件列表-->
                <ul id="ulFileList" class="fileBox" style="display:none;">
                    <li class="hrb"><img alt="" src="../images/icon18.png"></li>
                    <li class="fwa"><a id="FileName" href="#" target="_blank"></a><label class="state"></label></li>
                    <li><a id="downloadFile" href="" target="_blank"><img alt="" src="../images/icon19.png"></a></li>
                </ul>

                <div class="clear"></div>

                <div class="keep">
                    <span><a style="width:100px;margin-left:55px;" id="btnUpload" class="button" href="#">提交</a></span>
                    <span><a style="width:100px;;margin-left: 20px" class="button" href="#">取消</a></span>
                </div>
            </div>

        </div>
        <div class="clear">
        </div>
    </div>
    <!--#include file="/base/footer.html" -->
</body>
</html>
